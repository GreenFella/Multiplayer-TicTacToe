<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TicTacToe</title>
    <link rel="stylesheet" href="cssfile.css">
</head>
<body>
  <button onclick="findPlayerButton()">Find a second player</button> <br>
  <button onclick="styleToggle(), ready()">Ready</button>
    <div class="content">

<h1>TicTacToe</h1> <br> <br>

<svg width="700" height="700">

<line x1="233" y1="0" x2="233" y2="700" stroke="black"/>
<line x1="466" y1="0" x2="466" y2="700" stroke="black"/>
<line x1="0" y1="233" x2="700" y2="233" stroke="black"/>
<line x1="0" y1="466" x2="700" y2="466" stroke="black"/>

<circle id="circ1" class="circ1css" cx="116.5" cy="116.5" r="100" fill="none" stroke="none" stroke-width="15"/>

<line id="line1" class="line1css" x1="11.5" y1="11.5" x2="210" y2="210" stroke="none" stroke-width="15"/>

<rect class="rect1css" id="rect1" onclick="place(rect1.id)" x="1.5" y="1.5" width="230" height="230" fill="white"/>
<rect class="rect2css" id="rect2" x="234.5" y="1.5" width="230" height="230" fill="white"/>
<rect class="rect3css" id="rect3" x="467.5" y="1.5" width="230" height="230" fill="white"/>
<rect class="rect4css" id="rect4" x="1.5" y="234.5" width="230" height="230" fill="white"/>
<rect class="rect5css" id="rect5" x="234.5" y="234.5" width="230" height="230" fill="white"/>
<rect class="rect6css" id="rect6" x="467.5" y="234.5" width="230" height="230" fill="white"/>
<rect class="rect7css" id="rect7" x="1.5" y="467.5" width="230" height="230" fill="white"/>
<rect class="rect8css" id="rect8" x="234.5" y="467.5" width="230" height="230" fill="white"/>
<rect class="rect9css" id="rect9" x="467.5" y="467.5" width="230" height="230" fill="white"/>

    <script>

      window.addEventListener("load", (event) =>  {
        document.getElementById("circ1").classList.toggle("circ1css");
        document.getElementById("line1").classList.toggle("line1css");
      })

      function styleToggle () {
        if (player == 1) {
        document.getElementById("line1").classList.toggle("line1css");
        }
        else {
          document.getElementById("circ1").classList.toggle("circ1css");
        }
      }

      let player
      let clientSession

      const socket = new WebSocket("ws://localhost:8081");

      function findPlayerButton() {
          let objectWSFindPlayer = ({type: "waiting"})
          socket.send(JSON.stringify(objectWSFindPlayer));
          socket.addEventListener('message', function (message) {
            console.log(message.data)
            if (message.data.charAt(message.data.length-1) == "1") { //last digit returned is the player number ie. 1 or 2
              player = 1;
            }
            else if (message.data.charAt(message.data.length-1) == "2") { //last digit returned is the player number ie. 1 or 2
              player = 2;
            }
            clientSession = message.data.substring(0, message.data.length-1) //first number/s sent is the sessions number
          });
        }

        function place (location) {
          let locationNumber = location.charAt(location.length-1)
          let objectWSLocation = ({type: "updateLocation", sessionId: clientSession, player: player, locationNumber: locationNumber})
          socket.send(JSON.stringify(objectWSLocation));
        }
        
        function ready () {
        setInterval(retrieveUpdate, 250)

        function retrieveUpdate() { //Requests a player update every 250 miliseconds from the server
          let objectWSGetUpdate = ({type: "getUpdate", sessionId: clientSession, player: player})
          socket.send(JSON.stringify(objectWSGetUpdate));
          socket.addEventListener('message', function (message) {
            console.log(message.data)
          })
        }
      }

    </script>
  
</svg>

</div>
</body>
</html>